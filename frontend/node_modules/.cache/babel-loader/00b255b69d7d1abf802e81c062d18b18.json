{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/RajaJ/Downloads/YogaIntelliJ-main/YogaIntelliJ-main/frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/RajaJ/Downloads/YogaIntelliJ-main/YogaIntelliJ-main/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/RajaJ/Downloads/YogaIntelliJ-main/YogaIntelliJ-main/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as poseDetection from'@tensorflow-models/pose-detection';import*as tf from'@tensorflow/tfjs';import React,{useRef,useState,useEffect}from'react';import backend from'@tensorflow/tfjs-backend-webgl';import Webcam from'react-webcam';import{count}from'../../utils/music';import Instructions from'../../components/Instrctions/Instructions';import'./Yoga.css';import DropDown from'../../components/DropDown/DropDown';import{poseImages}from'../../utils/pose_images';import{POINTS,keypointConnections}from'../../utils/data';import{drawPoint,drawSegment}from'../../utils/helper';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var skeletonColor='rgb(255,255,255)';var poseList=['Tree','Chair',,'Warrior','Dog',,'Traingle'];var interval;// flag variable is used to help capture the time when AI just detect\n// the pose as correct(probability more than threshold)\nvar flag=false;function Yoga(){var webcamRef=useRef(null);var canvasRef=useRef(null);var _useState=useState(0),_useState2=_slicedToArray(_useState,2),startingTime=_useState2[0],setStartingTime=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),currentTime=_useState4[0],setCurrentTime=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),poseTime=_useState6[0],setPoseTime=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),bestPerform=_useState8[0],setBestPerform=_useState8[1];var _useState9=useState('Tree'),_useState10=_slicedToArray(_useState9,2),currentPose=_useState10[0],setCurrentPose=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isStartPose=_useState12[0],setIsStartPose=_useState12[1];useEffect(function(){var timeDiff=(currentTime-startingTime)/1000;if(flag){setPoseTime(timeDiff);}if((currentTime-startingTime)/1000>bestPerform){setBestPerform(timeDiff);}},[currentTime]);useEffect(function(){setCurrentTime(0);setPoseTime(0);setBestPerform(0);},[currentPose]);var CLASS_NO={Chair:0,Cobra:1,Dog:2,No_Pose:3,Shoulderstand:4,Traingle:5,Tree:6,Warrior:7};function get_center_point(landmarks,left_bodypart,right_bodypart){var left=tf.gather(landmarks,left_bodypart,1);var right=tf.gather(landmarks,right_bodypart,1);var center=tf.add(tf.mul(left,0.5),tf.mul(right,0.5));return center;}function get_pose_size(landmarks){var torso_size_multiplier=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2.5;var hips_center=get_center_point(landmarks,POINTS.LEFT_HIP,POINTS.RIGHT_HIP);var shoulders_center=get_center_point(landmarks,POINTS.LEFT_SHOULDER,POINTS.RIGHT_SHOULDER);var torso_size=tf.norm(tf.sub(shoulders_center,hips_center));var pose_center_new=get_center_point(landmarks,POINTS.LEFT_HIP,POINTS.RIGHT_HIP);pose_center_new=tf.expandDims(pose_center_new,1);pose_center_new=tf.broadcastTo(pose_center_new,[1,17,2]);// return: shape(17,2)\nvar d=tf.gather(tf.sub(landmarks,pose_center_new),0,0);var max_dist=tf.max(tf.norm(d,'euclidean',0));// normalize scale\nvar pose_size=tf.maximum(tf.mul(torso_size,torso_size_multiplier),max_dist);return pose_size;}function normalize_pose_landmarks(landmarks){var pose_center=get_center_point(landmarks,POINTS.LEFT_HIP,POINTS.RIGHT_HIP);pose_center=tf.expandDims(pose_center,1);pose_center=tf.broadcastTo(pose_center,[1,17,2]);landmarks=tf.sub(landmarks,pose_center);var pose_size=get_pose_size(landmarks);landmarks=tf.div(landmarks,pose_size);return landmarks;}function landmarks_to_embedding(landmarks){// normalize landmarks 2D\nlandmarks=normalize_pose_landmarks(tf.expandDims(landmarks,0));var embedding=tf.reshape(landmarks,[1,34]);return embedding;}var runMovenet=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var detectorConfig,detector,poseClassifier,countAudio;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:detectorConfig={modelType:poseDetection.movenet.modelType.SINGLEPOSE_THUNDER};_context.next=3;return poseDetection.createDetector(poseDetection.SupportedModels.MoveNet,detectorConfig);case 3:detector=_context.sent;_context.next=6;return tf.loadLayersModel('https://models.s3.jp-tok.cloud-object-storage.appdomain.cloud/model.json');case 6:poseClassifier=_context.sent;countAudio=new Audio(count);countAudio.loop=true;interval=setInterval(function(){detectPose(detector,poseClassifier,countAudio);},100);case 10:case\"end\":return _context.stop();}}},_callee);}));return function runMovenet(){return _ref.apply(this,arguments);};}();var detectPose=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(detector,poseClassifier,countAudio){var notDetected,video,pose,ctx,keypoints,input,processedInput,classification;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(typeof webcamRef.current!==\"undefined\"&&webcamRef.current!==null&&webcamRef.current.video.readyState===4)){_context2.next=22;break;}notDetected=0;video=webcamRef.current.video;_context2.next=5;return detector.estimatePoses(video);case 5:pose=_context2.sent;ctx=canvasRef.current.getContext('2d');ctx.clearRect(0,0,canvasRef.current.width,canvasRef.current.height);_context2.prev=8;keypoints=pose[0].keypoints;input=keypoints.map(function(keypoint){if(keypoint.score>0.4){if(!(keypoint.name==='left_eye'||keypoint.name==='right_eye')){drawPoint(ctx,keypoint.x,keypoint.y,8,'rgb(255,255,255)');var connections=keypointConnections[keypoint.name];try{connections.forEach(function(connection){var conName=connection.toUpperCase();drawSegment(ctx,[keypoint.x,keypoint.y],[keypoints[POINTS[conName]].x,keypoints[POINTS[conName]].y],skeletonColor);});}catch(err){}}}else{notDetected+=1;}return[keypoint.x,keypoint.y];});if(!(notDetected>4)){_context2.next=14;break;}skeletonColor='#ea6557';return _context2.abrupt(\"return\");case 14:processedInput=landmarks_to_embedding(input);classification=poseClassifier.predict(processedInput);classification.array().then(function(data){var classNo=CLASS_NO[currentPose];console.log(data[0][classNo]);if(data[0][classNo]>0.97){if(!flag){countAudio.play();setStartingTime(new Date(Date()).getTime());flag=true;}setCurrentTime(new Date(Date()).getTime());skeletonColor='rgb(0,255,0)';}else{flag=false;skeletonColor='#ea6557';countAudio.pause();countAudio.currentTime=0;}});_context2.next=22;break;case 19:_context2.prev=19;_context2.t0=_context2[\"catch\"](8);console.log(_context2.t0);case 22:case\"end\":return _context2.stop();}}},_callee2,null,[[8,19]]);}));return function detectPose(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();function startYoga(){setIsStartPose(true);runMovenet();}function stopPose(){setIsStartPose(false);clearInterval(interval);}if(isStartPose){return/*#__PURE__*/_jsxs(\"div\",{className:\"yoga-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"performance-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pose-performance\",children:/*#__PURE__*/_jsxs(\"h4\",{children:[\"Pose Time: \",poseTime,\" s\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"pose-performance\",children:/*#__PURE__*/_jsxs(\"h4\",{children:[\"Best: \",bestPerform,\" s\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Webcam,{width:\"640px\",height:\"480px\",id:\"webcam\",ref:webcamRef,style:{position:'absolute',left:120,top:100,padding:'0px'}}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,id:\"my-canvas\",width:\"640px\",height:\"480px\",style:{position:'absolute',left:120,top:100,zIndex:1}}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:poseImages[currentPose],className:\"pose-img\",style:{width:'30%',height:'61%',margin:'5%'}})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:stopPose,className:\"secondary-btn\",children:\"Stop Pose\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"yoga-container\",children:[/*#__PURE__*/_jsx(DropDown,{poseList:poseList,currentPose:currentPose,setCurrentPose:setCurrentPose}),/*#__PURE__*/_jsx(\"button\",{onClick:startYoga,className:\"secondary-btn\",children:\"Start Pose\"}),/*#__PURE__*/_jsx(Instructions,{currentPose:currentPose})]});}export default Yoga;","map":{"version":3,"sources":["C:/Users/RajaJ/Downloads/YogaIntelliJ-main/YogaIntelliJ-main/frontend/src/pages/Yoga/Yoga.js"],"names":["poseDetection","tf","React","useRef","useState","useEffect","backend","Webcam","count","Instructions","DropDown","poseImages","POINTS","keypointConnections","drawPoint","drawSegment","skeletonColor","poseList","interval","flag","Yoga","webcamRef","canvasRef","startingTime","setStartingTime","currentTime","setCurrentTime","poseTime","setPoseTime","bestPerform","setBestPerform","currentPose","setCurrentPose","isStartPose","setIsStartPose","timeDiff","CLASS_NO","Chair","Cobra","Dog","No_Pose","Shoulderstand","Traingle","Tree","Warrior","get_center_point","landmarks","left_bodypart","right_bodypart","left","gather","right","center","add","mul","get_pose_size","torso_size_multiplier","hips_center","LEFT_HIP","RIGHT_HIP","shoulders_center","LEFT_SHOULDER","RIGHT_SHOULDER","torso_size","norm","sub","pose_center_new","expandDims","broadcastTo","d","max_dist","max","pose_size","maximum","normalize_pose_landmarks","pose_center","div","landmarks_to_embedding","embedding","reshape","runMovenet","detectorConfig","modelType","movenet","SINGLEPOSE_THUNDER","createDetector","SupportedModels","MoveNet","detector","loadLayersModel","poseClassifier","countAudio","Audio","loop","setInterval","detectPose","current","video","readyState","notDetected","estimatePoses","pose","ctx","getContext","clearRect","width","height","keypoints","input","map","keypoint","score","name","x","y","connections","forEach","connection","conName","toUpperCase","err","processedInput","classification","predict","array","then","data","classNo","console","log","play","Date","getTime","pause","startYoga","stopPose","clearInterval","position","top","padding","zIndex","margin"],"mappings":"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","sourcesContent":["import * as poseDetection from '@tensorflow-models/pose-detection';\nimport * as tf from '@tensorflow/tfjs';\nimport React, { useRef, useState, useEffect } from 'react'\nimport backend from '@tensorflow/tfjs-backend-webgl'\nimport Webcam from 'react-webcam'\nimport { count } from '../../utils/music';\n\nimport Instructions from '../../components/Instrctions/Instructions';\n\nimport './Yoga.css'\n\nimport DropDown from '../../components/DropDown/DropDown';\nimport { poseImages } from '../../utils/pose_images';\nimport { POINTS, keypointConnections } from '../../utils/data';\nimport { drawPoint, drawSegment } from '../../utils/helper'\n\n\n\nlet skeletonColor = 'rgb(255,255,255)'\nlet poseList = [\n  'Tree', 'Chair', , 'Warrior', 'Dog',\n  , 'Traingle'\n]\n\nlet interval\n\n// flag variable is used to help capture the time when AI just detect\n// the pose as correct(probability more than threshold)\nlet flag = false\n\n\nfunction Yoga() {\n  const webcamRef = useRef(null)\n  const canvasRef = useRef(null)\n\n\n  const [startingTime, setStartingTime] = useState(0)\n  const [currentTime, setCurrentTime] = useState(0)\n  const [poseTime, setPoseTime] = useState(0)\n  const [bestPerform, setBestPerform] = useState(0)\n  const [currentPose, setCurrentPose] = useState('Tree')\n  const [isStartPose, setIsStartPose] = useState(false)\n\n\n  useEffect(() => {\n    const timeDiff = (currentTime - startingTime)/1000\n    if(flag) {\n      setPoseTime(timeDiff)\n    }\n    if((currentTime - startingTime)/1000 > bestPerform) {\n      setBestPerform(timeDiff)\n    }\n  }, [currentTime])\n\n\n  useEffect(() => {\n    setCurrentTime(0)\n    setPoseTime(0)\n    setBestPerform(0)\n  }, [currentPose])\n\n  const CLASS_NO = {\n    Chair: 0,\n    Cobra: 1,\n    Dog: 2,\n    No_Pose: 3,\n    Shoulderstand: 4,\n    Traingle: 5,\n    Tree: 6,\n    Warrior: 7,\n  }\n\n  function get_center_point(landmarks, left_bodypart, right_bodypart) {\n    let left = tf.gather(landmarks, left_bodypart, 1)\n    let right = tf.gather(landmarks, right_bodypart, 1)\n    const center = tf.add(tf.mul(left, 0.5), tf.mul(right, 0.5))\n    return center\n\n  }\n\n  function get_pose_size(landmarks, torso_size_multiplier=2.5) {\n    let hips_center = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP)\n    let shoulders_center = get_center_point(landmarks,POINTS.LEFT_SHOULDER, POINTS.RIGHT_SHOULDER)\n    let torso_size = tf.norm(tf.sub(shoulders_center, hips_center))\n    let pose_center_new = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP)\n    pose_center_new = tf.expandDims(pose_center_new, 1)\n\n    pose_center_new = tf.broadcastTo(pose_center_new,\n        [1, 17, 2]\n      )\n      // return: shape(17,2)\n    let d = tf.gather(tf.sub(landmarks, pose_center_new), 0, 0)\n    let max_dist = tf.max(tf.norm(d,'euclidean', 0))\n\n    // normalize scale\n    let pose_size = tf.maximum(tf.mul(torso_size, torso_size_multiplier), max_dist)\n    return pose_size\n  }\n\n  function normalize_pose_landmarks(landmarks) {\n    let pose_center = get_center_point(landmarks, POINTS.LEFT_HIP, POINTS.RIGHT_HIP)\n    pose_center = tf.expandDims(pose_center, 1)\n    pose_center = tf.broadcastTo(pose_center,\n        [1, 17, 2]\n      )\n    landmarks = tf.sub(landmarks, pose_center)\n\n    let pose_size = get_pose_size(landmarks)\n    landmarks = tf.div(landmarks, pose_size)\n    return landmarks\n  }\n\n  function landmarks_to_embedding(landmarks) {\n    // normalize landmarks 2D\n    landmarks = normalize_pose_landmarks(tf.expandDims(landmarks, 0))\n    let embedding = tf.reshape(landmarks, [1,34])\n    return embedding\n  }\n\n  const runMovenet = async () => {\n    const detectorConfig = {modelType: poseDetection.movenet.modelType.SINGLEPOSE_THUNDER};\n    const detector = await poseDetection.createDetector(poseDetection.SupportedModels.MoveNet, detectorConfig);\n    const poseClassifier = await tf.loadLayersModel('https://models.s3.jp-tok.cloud-object-storage.appdomain.cloud/model.json')\n    const countAudio = new Audio(count)\n    countAudio.loop = true\n    interval = setInterval(() => {\n        detectPose(detector, poseClassifier, countAudio)\n    }, 100)\n  }\n\n  const detectPose = async (detector, poseClassifier, countAudio) => {\n    if (\n      typeof webcamRef.current !== \"undefined\" &&\n      webcamRef.current !== null &&\n      webcamRef.current.video.readyState === 4\n    ) {\n      let notDetected = 0\n      const video = webcamRef.current.video\n      const pose = await detector.estimatePoses(video)\n      const ctx = canvasRef.current.getContext('2d')\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      try {\n        const keypoints = pose[0].keypoints\n        let input = keypoints.map((keypoint) => {\n          if(keypoint.score > 0.4) {\n            if(!(keypoint.name === 'left_eye' || keypoint.name === 'right_eye')) {\n              drawPoint(ctx, keypoint.x, keypoint.y, 8, 'rgb(255,255,255)')\n              let connections = keypointConnections[keypoint.name]\n              try {\n                connections.forEach((connection) => {\n                  let conName = connection.toUpperCase()\n                  drawSegment(ctx, [keypoint.x, keypoint.y],\n                      [keypoints[POINTS[conName]].x,\n                       keypoints[POINTS[conName]].y]\n                  , skeletonColor)\n                })\n              } catch(err) {\n\n              }\n\n            }\n          } else {\n            notDetected += 1\n          }\n          return [keypoint.x, keypoint.y]\n        })\n        if(notDetected > 4) {\n          skeletonColor = '#ea6557'\n          return\n        }\n        const processedInput = landmarks_to_embedding(input)\n        const classification = poseClassifier.predict(processedInput)\n\n        classification.array().then((data) => {\n          const classNo = CLASS_NO[currentPose]\n          console.log(data[0][classNo])\n          if(data[0][classNo] > 0.97) {\n\n            if(!flag) {\n              countAudio.play()\n              setStartingTime(new Date(Date()).getTime())\n              flag = true\n            }\n            setCurrentTime(new Date(Date()).getTime())\n            skeletonColor = 'rgb(0,255,0)'\n          } else {\n            flag = false\n            skeletonColor = '#ea6557'\n            countAudio.pause()\n            countAudio.currentTime = 0\n          }\n        })\n      } catch(err) {\n        console.log(err)\n      }\n\n\n    }\n  }\n\n  function startYoga(){\n    setIsStartPose(true)\n    runMovenet()\n  }\n\n  function stopPose() {\n    setIsStartPose(false)\n    clearInterval(interval)\n  }\n\n\n\n  if(isStartPose) {\n    return (\n      <div className=\"yoga-container\">\n        <div className=\"performance-container\">\n            <div className=\"pose-performance\">\n              <h4>Pose Time: {poseTime} s</h4>\n            </div>\n            <div className=\"pose-performance\">\n              <h4>Best: {bestPerform} s</h4>\n            </div>\n          </div>\n        <div>\n\n          <Webcam\n          width='640px'\n          height='480px'\n          id=\"webcam\"\n          ref={webcamRef}\n          style={{\n            position: 'absolute',\n            left: 120,\n            top: 100,\n            padding: '0px',\n          }}\n        />\n          <canvas\n            ref={canvasRef}\n            id=\"my-canvas\"\n            width='640px'\n            height='480px'\n            style={{\n              position: 'absolute',\n              left: 120,\n              top: 100,\n              zIndex: 1\n            }}\n          >\n          </canvas>\n        <div>\n            <img\n              src={poseImages[currentPose]}\n              className=\"pose-img\"\n              style={{\n              width:'30%',\n              height: '61%',\n\n              margin:'5%',\n\n              }}\n            />\n          </div>\n\n        </div>\n        <button\n          onClick={stopPose}\n          className=\"secondary-btn\"\n        >Stop Pose</button>\n      </div>\n    )\n  }\n\n  return (\n    <div\n      className=\"yoga-container\"\n    >\n\n      <DropDown\n        poseList={poseList}\n        currentPose={currentPose}\n        setCurrentPose={setCurrentPose}\n      />\n      <button\n          onClick={startYoga}\n          className=\"secondary-btn\"\n        >Start Pose</button>\n\n      <Instructions\n          currentPose={currentPose}\n        />\n\n\n    </div>\n  )\n}\n\nexport default Yoga\n"]},"metadata":{},"sourceType":"module"}